<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>P2P Chat - No Server</title>
<style>
  body{font-family:sans-serif;max-width:600px;margin:auto;padding:20px;}
  textarea{width:100%;height:80px;}
  #log{border:1px solid #ccc;height:200px;overflow:auto;padding:10px;margin-top:10px;}
</style>
</head>
<body>
<h2>Realtime Chat (No Server - WebRTC P2P)</h2>

<button id="createOffer">Create Offer</button>
<textarea id="offer" placeholder="Offer will appear here"></textarea>

<button id="setAnswer">Set Answer</button>
<textarea id="answer" placeholder="Paste Answer here"></textarea>

<hr>

<div id="chat" style="display:none;">
  <div id="log"></div>
  <input id="msg" type="text" placeholder="Type messageâ€¦">
  <button id="send">Send</button>
</div>

<script>
let pc = new RTCPeerConnection();
let channel = pc.createDataChannel("chat");

channel.onmessage = e => {
  log("Friend: " + e.data);
};

pc.onicecandidate = e => {
  if(e.candidate) return;
  offer.value = JSON.stringify(pc.localDescription);
};

pc.ondatachannel = e => {
  channel = e.channel;
  channel.onmessage = ev => log("Friend: " + ev.data);
};

function log(t){
  logDiv.innerHTML += t + "<br>";
  logDiv.scrollTop = logDiv.scrollHeight;
}

createOffer.onclick = async () => {
  let desc = await pc.createOffer();
  await pc.setLocalDescription(desc);
};

setAnswer.onclick = async () => {
  let ans = JSON.parse(answer.value);
  await pc.setRemoteDescription(ans);
  document.getElementById("chat").style.display = "block";
};

send.onclick = () => {
  let text = msg.value;
  channel.send(text);
  log("Me: " + text);
  msg.value = "";
};

msg.addEventListener("keypress", e => {
  if(e.key === "Enter") send.click();
});

</script>
</body>
</html>

